/*!
 * maptalks.odline v0.1.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@^0.23.1 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function i(t,e){for(var i=Object.getOwnPropertyNames(e),o=0;o<i.length;o++){var n=i[o],r=Object.getOwnPropertyDescriptor(e,n);r&&r.configurable&&void 0===t[n]&&Object.defineProperty(t,n,r)}return t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):i(t,e))}function a(t,e,i,o){var n=1-o;return n*(n*t+2*o*e)+o*o*i}var s={animation:!0,animationOnce:!1,animatinDuration:6e3,random:!1,curveness:.2,trail:20,globalCompositeOperation:"lighter"},p={lineColor:"#000",lineWidth:2},d=function(t){function i(e,r,a){o(this,i),r&&!Array.isArray(r)&&(r=[r]);var s=n(this,t.call(this,e,a));return s.setData(r),s}return r(i,t),i.prototype.getData=function(){return this._data},i.prototype.setData=function(t){return this._data=t,this.getMap()&&(this._prepareData(),this._getRenderer()&&this._getRenderer().render()),this},i.prototype.identify=function(){return null},i.prototype.getParticles=function(t){this._animStartTime||(this._animStartTime=Date.now());var i=this.getMap(),o=i.getScale(),n=t-this._animStartTime,r=this.options.animationDuration;if(this.options.animationOnce&&n>r)return[];for(var s=n%r/r,p=[],d={},u=void 0,l=void 0,h=void 0,c=void 0,f=void 0,y=void 0,m=void 0,_=0,v=this._dataToDraw.length;_<v;_++)this.options.random&&(s=(t-this._animStartTime-this._dataToDraw[_].time)%r/r)<0&&(s=0),s>0&&(u=this._dataToDraw[_].points,c=this._data[_].symbol||d,f=u[0],y=u[1],u[2]?(m=u[2],l=a(f.x,m.x,y.x,s),h=a(f.y,m.y,y.y,s)):(l=f.x+s*(y.x-f.x),h=f.y+s*(y.y-f.y)),p.push({point:i._pointToContainerPoint(new e.Point(l,h)._multi(1/o)),r:(c.lineWidth||3)/2,color:c.lineColor}));return p},i.prototype.draw=function(e){return this._dataToDraw||this._prepareData(),this.options.animation?t.prototype.draw.apply(this,arguments):(this._drawLines(e),this)},i.prototype.onConfig=function(){this._getRenderer()&&this._getRenderer().render()},i.prototype.onRemove=function(){delete this._dataToDraw},i.prototype.toJSON=function(t){t||(t={});var i={type:this.getJSONType(),id:this.getId(),options:this.config()},o=this.getData();if(t.clipExtent){for(var n=new e.Extent(t.clipExtent),r=[],a=0,s=o.length;a<s;a++)n.contains(new e.Coordinate(o[a][0],o[a][1]))&&r.push(o[a]);i.data=r}else i.data=o;return i},i.fromJSON=function(t){return t&&t.type===this.getJSONType()?new i(t.id,t.data,t.options):null},i.prototype._precise=function(t){return e.Util.round(100*t)/100},i.prototype._drawLines=function(t){if(this._dataToDraw){var e=this.getMap(),i=e.getScale(),o={},n=this.options.symbol||p,r=void 0,a=void 0,s=void 0,d=void 0,u=void 0;t.lineCap="round";for(var l=0,h=this._dataToDraw.length;l<h;l++)r=this._dataToDraw[l].points,a=this._data[l].symbol||o,t.strokeStyle=a.lineColor||n.lineColor||"rgba(255, 255, 255, 0.01)",t.lineWidth=a.lineWidth||n.lineWidth||1,t.beginPath(),s=e._pointToContainerPoint(r[0].multi(1/i)),t.moveTo(s.x,s.y),d=e._pointToContainerPoint(r[1].multi(1/i)),r[2]?(u=e._pointToContainerPoint(r[2].multi(1/i)),t.quadraticCurveTo(u.x,u.y,d.x,d.y)):t.lineTo(d.x,d.y),t.stroke()}},i.prototype._prepareData=function(){if(this._data){for(var t=this.options.curveness,i=this.getMap(),o=i.getMaxNativeZoom(),n=[],r=void 0,a=void 0,s=0,p=this._data.length;s<p;s++){r=i.coordinateToPoint(new e.Coordinate(this._data[s].coordinates[0]),o),a=i.coordinateToPoint(new e.Coordinate(this._data[s].coordinates[1]),o);var d=[r,a];if(t){var u=a.distanceTo(r),l=r.substract(a)._unit()._perp(),h=r.add(a)._multi(.5),c=t*u,f=new e.Point(h.x+c*l.x,h.y+c*l.y);d.push(f)}n.push({points:d,time:Math.random()*this.options.animationDuration})}this._dataToDraw=n}},i}(e.ParticleLayer);d.mergeOptions(s),d.registerJSONType("ODLineLayer"),t.ODLineLayer=d,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.odline v0.1.0, requires maptalks@^0.23.1.")});